<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Data Analysis in Ecology with R and Stan</title>
  <meta name="description" content="This GitHub-book is collection of updates and additional material to the book Bayesian Data Analysis in Ecology Using Linear Models with R, BUGS, and STAN.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Data Analysis in Ecology with R and Stan" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/cover.jpg" />
  <meta property="og:description" content="This GitHub-book is collection of updates and additional material to the book Bayesian Data Analysis in Ecology Using Linear Models with R, BUGS, and STAN." />
  <meta name="github-repo" content="TobiasRoth/BDAEcology" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Data Analysis in Ecology with R and Stan" />
  
  <meta name="twitter:description" content="This GitHub-book is collection of updates and additional material to the book Bayesian Data Analysis in Ecology Using Linear Models with R, BUGS, and STAN." />
  <meta name="twitter:image" content="images/cover.jpg" />

<meta name="author" content="Fränzi Korner-Nievergelt and Tobias Roth">


<meta name="date" content="2018-11-27">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="zeroinflated-poisson-lmm.html">
<link rel="next" href="referenzen.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="Settings/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-this-book"><i class="fa fa-check"></i>Why this book?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-this-book"><i class="fa fa-check"></i>About this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-contribute"><i class="fa fa-check"></i>How to contribute?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="part"><span><b>I R FOR ECOLOGISTS</b></span></li>
<li class="chapter" data-level="1" data-path="PART-I.html"><a href="PART-I.html"><i class="fa fa-check"></i><b>1</b> Introduction to PART I</a><ul>
<li class="chapter" data-level="1.1" data-path="PART-I.html"><a href="PART-I.html#further-reading"><i class="fa fa-check"></i><b>1.1</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="basics.html"><a href="basics.html"><i class="fa fa-check"></i><b>2</b> Prerequisits: Basic statistical terms</a><ul>
<li class="chapter" data-level="2.1" data-path="basics.html"><a href="basics.html#scale-of-measurement"><i class="fa fa-check"></i><b>2.1</b> Scale of measurement</a></li>
<li class="chapter" data-level="2.2" data-path="basics.html"><a href="basics.html#correlations"><i class="fa fa-check"></i><b>2.2</b> Correlations</a><ul>
<li class="chapter" data-level="2.2.1" data-path="basics.html"><a href="basics.html#basics-of-variances-covariances-and-correlations"><i class="fa fa-check"></i><b>2.2.1</b> Basics of variances, covariances and correlations</a></li>
<li class="chapter" data-level="2.2.2" data-path="basics.html"><a href="basics.html#pearson-correlation-coefficient"><i class="fa fa-check"></i><b>2.2.2</b> Pearson correlation coefficient</a></li>
<li class="chapter" data-level="2.2.3" data-path="basics.html"><a href="basics.html#spearman-correlation-coefficient"><i class="fa fa-check"></i><b>2.2.3</b> Spearman correlation coefficient</a></li>
<li class="chapter" data-level="2.2.4" data-path="basics.html"><a href="basics.html#kendalls-tau"><i class="fa fa-check"></i><b>2.2.4</b> Kendall’s tau</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="basics.html"><a href="basics.html#principal-components-analyses-pca"><i class="fa fa-check"></i><b>2.3</b> Principal components analyses PCA</a><ul>
<li class="chapter" data-level="2.3.1" data-path="basics.html"><a href="basics.html#inferential-statistics"><i class="fa fa-check"></i><b>2.3.1</b> Inferential statistics</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="basics.html"><a href="basics.html#standard-deviation-and-standard-error"><i class="fa fa-check"></i><b>2.4</b> Standard deviation and standard error</a></li>
<li class="chapter" data-level="2.5" data-path="basics.html"><a href="basics.html#central-limit-theorem-law-of-large-numbers"><i class="fa fa-check"></i><b>2.5</b> Central limit theorem / law of large numbers</a></li>
<li class="chapter" data-level="2.6" data-path="basics.html"><a href="basics.html#bayes-theorem"><i class="fa fa-check"></i><b>2.6</b> Bayes theorem</a></li>
<li class="chapter" data-level="2.7" data-path="basics.html"><a href="basics.html#bayes-theorem-for-continuous-parameters"><i class="fa fa-check"></i><b>2.7</b> Bayes theorem for continuous parameters</a></li>
<li class="chapter" data-level="2.8" data-path="basics.html"><a href="basics.html#single-parameter-model"><i class="fa fa-check"></i><b>2.8</b> Single parameter model</a></li>
<li class="chapter" data-level="2.9" data-path="basics.html"><a href="basics.html#a-model-with-two-parameters"><i class="fa fa-check"></i><b>2.9</b> A model with two parameters</a></li>
<li class="chapter" data-level="2.10" data-path="basics.html"><a href="basics.html#t-distribution"><i class="fa fa-check"></i><b>2.10</b> t-distribution</a></li>
<li class="chapter" data-level="2.11" data-path="basics.html"><a href="basics.html#frequentist-one-sample-t-test"><i class="fa fa-check"></i><b>2.11</b> Frequentist one-sample t-test</a></li>
<li class="chapter" data-level="2.12" data-path="basics.html"><a href="basics.html#nullhypothesis-test"><i class="fa fa-check"></i><b>2.12</b> Nullhypothesis test</a></li>
<li class="chapter" data-level="2.13" data-path="basics.html"><a href="basics.html#confidence-interval"><i class="fa fa-check"></i><b>2.13</b> Confidence interval</a></li>
<li class="chapter" data-level="2.14" data-path="basics.html"><a href="basics.html#posterior-distribution"><i class="fa fa-check"></i><b>2.14</b> Posterior distribution</a></li>
<li class="chapter" data-level="2.15" data-path="basics.html"><a href="basics.html#posterior-probability"><i class="fa fa-check"></i><b>2.15</b> Posterior probability</a></li>
<li class="chapter" data-level="2.16" data-path="basics.html"><a href="basics.html#monte-carlo-simulation-parametric-bootstrap"><i class="fa fa-check"></i><b>2.16</b> Monte Carlo simulation (parametric bootstrap)</a></li>
<li class="chapter" data-level="2.17" data-path="basics.html"><a href="basics.html#methods-for-getting-the-posterior-distribution"><i class="fa fa-check"></i><b>2.17</b> 3 methods for getting the posterior distribution</a></li>
<li class="chapter" data-level="2.18" data-path="basics.html"><a href="basics.html#grid-approximation"><i class="fa fa-check"></i><b>2.18</b> Grid approximation</a></li>
<li class="chapter" data-level="2.19" data-path="basics.html"><a href="basics.html#monte-carlo-simulations"><i class="fa fa-check"></i><b>2.19</b> Monte Carlo simulations</a></li>
<li class="chapter" data-level="2.20" data-path="basics.html"><a href="basics.html#comparison-of-the-locations-between-two-groups"><i class="fa fa-check"></i><b>2.20</b> Comparison of the locations between two groups</a></li>
<li class="chapter" data-level="2.21" data-path="basics.html"><a href="basics.html#difference-between-two-means"><i class="fa fa-check"></i><b>2.21</b> Difference between two means</a></li>
<li class="chapter" data-level="2.22" data-path="basics.html"><a href="basics.html#two-sample-t-test"><i class="fa fa-check"></i><b>2.22</b> Two-sample t-test</a></li>
<li class="chapter" data-level="2.23" data-path="basics.html"><a href="basics.html#wilxocon-test"><i class="fa fa-check"></i><b>2.23</b> Wilxocon test</a></li>
<li class="chapter" data-level="2.24" data-path="basics.html"><a href="basics.html#randomisation-test"><i class="fa fa-check"></i><b>2.24</b> Randomisation test</a></li>
<li class="chapter" data-level="2.25" data-path="basics.html"><a href="basics.html#bootstrap"><i class="fa fa-check"></i><b>2.25</b> Bootstrap</a></li>
<li class="chapter" data-level="2.26" data-path="basics.html"><a href="basics.html#f-distribution"><i class="fa fa-check"></i><b>2.26</b> F-distribution</a><ul>
<li class="chapter" data-level="2.26.1" data-path="basics.html"><a href="basics.html#analysis-of-variance-anova"><i class="fa fa-check"></i><b>2.26.1</b> Analysis of variance ANOVA</a></li>
</ul></li>
<li class="chapter" data-level="2.27" data-path="basics.html"><a href="basics.html#chisquare-test"><i class="fa fa-check"></i><b>2.27</b> Chisquare test</a></li>
<li class="chapter" data-level="2.28" data-path="basics.html"><a href="basics.html#bayesian-way-of-analysing-correlations-between-categorical-variables"><i class="fa fa-check"></i><b>2.28</b> Bayesian way of analysing correlations between categorical variables</a></li>
<li class="chapter" data-level="2.29" data-path="basics.html"><a href="basics.html#summary"><i class="fa fa-check"></i><b>2.29</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="analyses-steps.html"><a href="analyses-steps.html"><i class="fa fa-check"></i><b>3</b> Data analysis step by step</a><ul>
<li class="chapter" data-level="3.1" data-path="analyses-steps.html"><a href="analyses-steps.html#step1"><i class="fa fa-check"></i><b>3.1</b> Plausibility of Data</a></li>
<li class="chapter" data-level="3.2" data-path="analyses-steps.html"><a href="analyses-steps.html#step2"><i class="fa fa-check"></i><b>3.2</b> Relationships</a></li>
<li class="chapter" data-level="3.3" data-path="analyses-steps.html"><a href="analyses-steps.html#step3"><i class="fa fa-check"></i><b>3.3</b> Error Distribution</a></li>
<li class="chapter" data-level="3.4" data-path="analyses-steps.html"><a href="analyses-steps.html#step4"><i class="fa fa-check"></i><b>3.4</b> Preparation of Explanatory Variables</a></li>
<li class="chapter" data-level="3.5" data-path="analyses-steps.html"><a href="analyses-steps.html#step5"><i class="fa fa-check"></i><b>3.5</b> Data Structure</a></li>
<li class="chapter" data-level="3.6" data-path="analyses-steps.html"><a href="analyses-steps.html#step6"><i class="fa fa-check"></i><b>3.6</b> Fit the Model</a></li>
<li class="chapter" data-level="3.7" data-path="analyses-steps.html"><a href="analyses-steps.html#step7"><i class="fa fa-check"></i><b>3.7</b> Check Model</a></li>
<li class="chapter" data-level="3.8" data-path="analyses-steps.html"><a href="analyses-steps.html#step8"><i class="fa fa-check"></i><b>3.8</b> Model Uncertainty</a></li>
<li class="chapter" data-level="3.9" data-path="analyses-steps.html"><a href="analyses-steps.html#step9"><i class="fa fa-check"></i><b>3.9</b> Draw Conclusions</a></li>
<li class="chapter" data-level="" data-path="analyses-steps.html"><a href="analyses-steps.html#further-reading-1"><i class="fa fa-check"></i>Further reading</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="datamanip.html"><a href="datamanip.html"><i class="fa fa-check"></i><b>4</b> Data preparation</a><ul>
<li class="chapter" data-level="4.1" data-path="datamanip.html"><a href="datamanip.html#basic-operations"><i class="fa fa-check"></i><b>4.1</b> Basic operations</a></li>
<li class="chapter" data-level="4.2" data-path="datamanip.html"><a href="datamanip.html#joindata"><i class="fa fa-check"></i><b>4.2</b> Joining tables</a></li>
<li class="chapter" data-level="4.3" data-path="datamanip.html"><a href="datamanip.html#further-reading-2"><i class="fa fa-check"></i><b>4.3</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="distributions.html"><a href="distributions.html"><i class="fa fa-check"></i><b>5</b> Probability distributions</a><ul>
<li class="chapter" data-level="5.1" data-path="distributions.html"><a href="distributions.html#introduction"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="distributions.html"><a href="distributions.html#normal-distribution"><i class="fa fa-check"></i><b>5.2</b> Normal distribution</a></li>
<li class="chapter" data-level="5.3" data-path="distributions.html"><a href="distributions.html#poisson-distribution"><i class="fa fa-check"></i><b>5.3</b> Poisson distribution</a></li>
<li class="chapter" data-level="5.4" data-path="distributions.html"><a href="distributions.html#gamma-distribution"><i class="fa fa-check"></i><b>5.4</b> Gamma distribution</a><ul>
<li class="chapter" data-level="5.4.1" data-path="distributions.html"><a href="distributions.html#cauchydistri"><i class="fa fa-check"></i><b>5.4.1</b> Cauchy distribution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="figures.html"><a href="figures.html"><i class="fa fa-check"></i><b>6</b> Visualizations</a><ul>
<li class="chapter" data-level="6.1" data-path="figures.html"><a href="figures.html#short-checklist-for-figures"><i class="fa fa-check"></i><b>6.1</b> Short Checklist for figures</a></li>
<li class="chapter" data-level="" data-path="figures.html"><a href="figures.html#further-reading-3"><i class="fa fa-check"></i>Further reading</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="rgis.html"><a href="rgis.html"><i class="fa fa-check"></i><b>7</b> Spatial analyses and maps</a><ul>
<li class="chapter" data-level="7.1" data-path="rgis.html"><a href="rgis.html#data-types"><i class="fa fa-check"></i><b>7.1</b> Data types</a><ul>
<li class="chapter" data-level="7.1.1" data-path="rgis.html"><a href="rgis.html#rasterdata"><i class="fa fa-check"></i><b>7.1.1</b> Raster data</a></li>
<li class="chapter" data-level="7.1.2" data-path="rgis.html"><a href="rgis.html#geometrydata"><i class="fa fa-check"></i><b>7.1.2</b> Geometry data</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="rgis.html"><a href="rgis.html#basic-functions"><i class="fa fa-check"></i><b>7.2</b> Basic functions</a><ul>
<li class="chapter" data-level="7.2.1" data-path="rgis.html"><a href="rgis.html#coordinate-systems"><i class="fa fa-check"></i><b>7.2.1</b> Coordinate systems</a></li>
<li class="chapter" data-level="7.2.2" data-path="rgis.html"><a href="rgis.html#joining-spatial-data"><i class="fa fa-check"></i><b>7.2.2</b> Joining spatial data</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="rgis.html"><a href="rgis.html#further-reading-4"><i class="fa fa-check"></i><b>7.3</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="reproducible.html"><a href="reproducible.html"><i class="fa fa-check"></i><b>8</b> Reproducible Research</a><ul>
<li class="chapter" data-level="8.1" data-path="reproducible.html"><a href="reproducible.html#introduction-1"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="reproducible.html"><a href="reproducible.html#further-reading-5"><i class="fa fa-check"></i><b>8.2</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="furthertopics.html"><a href="furthertopics.html"><i class="fa fa-check"></i><b>9</b> Further topics</a><ul>
<li class="chapter" data-level="9.1" data-path="furthertopics.html"><a href="furthertopics.html#bioacoustic-analyse"><i class="fa fa-check"></i><b>9.1</b> Bioacoustic analyse</a></li>
<li class="chapter" data-level="9.2" data-path="furthertopics.html"><a href="furthertopics.html#python"><i class="fa fa-check"></i><b>9.2</b> Python</a></li>
</ul></li>
<li class="part"><span><b>II BAYESIAN DATA ANALYSIS</b></span></li>
<li class="chapter" data-level="10" data-path="PART-II.html"><a href="PART-II.html"><i class="fa fa-check"></i><b>10</b> Introduction to PART II</a><ul>
<li class="chapter" data-level="" data-path="PART-II.html"><a href="PART-II.html#further-reading-6"><i class="fa fa-check"></i>Further reading</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="priors.html"><a href="priors.html"><i class="fa fa-check"></i><b>11</b> Prior distributions</a><ul>
<li class="chapter" data-level="11.1" data-path="priors.html"><a href="priors.html#introduction-2"><i class="fa fa-check"></i><b>11.1</b> Introduction</a></li>
<li class="chapter" data-level="11.2" data-path="priors.html"><a href="priors.html#choosepriors"><i class="fa fa-check"></i><b>11.2</b> How to choose a prior</a></li>
<li class="chapter" data-level="11.3" data-path="priors.html"><a href="priors.html#prior-sensitivity"><i class="fa fa-check"></i><b>11.3</b> Prior sensitivity</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="stan.html"><a href="stan.html"><i class="fa fa-check"></i><b>12</b> MCMC using Stan</a><ul>
<li class="chapter" data-level="12.1" data-path="stan.html"><a href="stan.html#background"><i class="fa fa-check"></i><b>12.1</b> Background</a></li>
<li class="chapter" data-level="12.2" data-path="stan.html"><a href="stan.html#install-rstan"><i class="fa fa-check"></i><b>12.2</b> Install <code>rstan</code></a></li>
<li class="chapter" data-level="12.3" data-path="stan.html"><a href="stan.html#firststanmod"><i class="fa fa-check"></i><b>12.3</b> Writing a Stan model</a></li>
<li class="chapter" data-level="12.4" data-path="stan.html"><a href="stan.html#run-stan-from-r"><i class="fa fa-check"></i><b>12.4</b> Run Stan from R</a></li>
<li class="chapter" data-level="" data-path="stan.html"><a href="stan.html#further-reading-7"><i class="fa fa-check"></i>Further reading</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="ridge.html"><a href="ridge.html"><i class="fa fa-check"></i><b>13</b> Ridge regression</a><ul>
<li class="chapter" data-level="13.1" data-path="ridge.html"><a href="ridge.html#introduction-3"><i class="fa fa-check"></i><b>13.1</b> Introduction</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="sem.html"><a href="sem.html"><i class="fa fa-check"></i><b>14</b> Structural equation model</a><ul>
<li class="chapter" data-level="14.1" data-path="sem.html"><a href="sem.html#introduction-4"><i class="fa fa-check"></i><b>14.1</b> Introduction</a></li>
</ul></li>
<li class="part"><span><b>III ECOLOGICAL MODELS</b></span></li>
<li class="chapter" data-level="15" data-path="PART-III.html"><a href="PART-III.html"><i class="fa fa-check"></i><b>15</b> Introduction to PART III</a><ul>
<li class="chapter" data-level="15.1" data-path="PART-III.html"><a href="PART-III.html#model-notations"><i class="fa fa-check"></i><b>15.1</b> Model notations</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="zeroinflated-poisson-lmm.html"><a href="zeroinflated-poisson-lmm.html"><i class="fa fa-check"></i><b>16</b> Zero-inflated Poisson Mixed Model</a><ul>
<li class="chapter" data-level="16.1" data-path="zeroinflated-poisson-lmm.html"><a href="zeroinflated-poisson-lmm.html#introduction-5"><i class="fa fa-check"></i><b>16.1</b> Introduction</a></li>
<li class="chapter" data-level="16.2" data-path="zeroinflated-poisson-lmm.html"><a href="zeroinflated-poisson-lmm.html#example-data"><i class="fa fa-check"></i><b>16.2</b> Example data</a></li>
<li class="chapter" data-level="16.3" data-path="zeroinflated-poisson-lmm.html"><a href="zeroinflated-poisson-lmm.html#model"><i class="fa fa-check"></i><b>16.3</b> Model</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="cjs-with-mix.html"><a href="cjs-with-mix.html"><i class="fa fa-check"></i><b>17</b> Capture-mark recapture model with a mixture structure to account for missing sex-variable for parts of the individuals</a><ul>
<li class="chapter" data-level="17.1" data-path="cjs-with-mix.html"><a href="cjs-with-mix.html#introduction-6"><i class="fa fa-check"></i><b>17.1</b> Introduction</a></li>
<li class="chapter" data-level="17.2" data-path="cjs-with-mix.html"><a href="cjs-with-mix.html#data-description"><i class="fa fa-check"></i><b>17.2</b> Data description</a></li>
<li class="chapter" data-level="17.3" data-path="cjs-with-mix.html"><a href="cjs-with-mix.html#model-description"><i class="fa fa-check"></i><b>17.3</b> Model description</a></li>
<li class="chapter" data-level="17.4" data-path="cjs-with-mix.html"><a href="cjs-with-mix.html#the-stan-code"><i class="fa fa-check"></i><b>17.4</b> The Stan code</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="referenzen.html"><a href="referenzen.html"><i class="fa fa-check"></i>Referenzen</a></li>
<li class="divider"></li>
</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Analysis in Ecology with R and Stan</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cjs_with_mix" class="section level1">
<h1><span class="header-section-number">17</span> Capture-mark recapture model with a mixture structure to account for missing sex-variable for parts of the individuals</h1>
<div id="introduction-6" class="section level2">
<h2><span class="header-section-number">17.1</span> Introduction</h2>
<p>In some species the identification of the sex is not possible for all individuals without sampling DNA. For example, morphological dimorphism is absent or so weak that parts of the individuals cannot be assigned to one of the sexes. Particularly in ornithological long-term capture recapture data sets that typically are obtained by voluntary bird ringers who do normaly not have the possibilities to analyse DNA, often the sex identification is missing in parts of the individuals. For estimating survival, it would nevertheless be valuable to include data of all individuals, use the information on sex-specific effects on survival wherever possible but account for the fact that of parts of the individuals the sex is not known. We here explain how a Cormack-Jolly-Seber model can be integrated with a mixture model in oder to allow for a combined analyses of individuals with and without sex identified.
An introduction to the Cormack-Jolly-Seber model we gave in Chapter 14.5 of the book <span class="citation">Korner-Nievergelt et al. (<a href="referenzen.html#ref-KornerNievergelt2015">2015</a>)</span>. We here expand this model by a mixture structure that allows including individuals with a missing categorical predictor variable, such as sex.</p>
</div>
<div id="data-description" class="section level2">
<h2><span class="header-section-number">17.2</span> Data description</h2>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1"><span class="co"># true parameter values</span></a>
<a class="sourceLine" id="cb50-2" data-line-number="2">theta  &lt;-<span class="st"> </span><span class="fl">0.6</span> <span class="co"># proportion of males</span></a>
<a class="sourceLine" id="cb50-3" data-line-number="3">nocc &lt;-<span class="st"> </span><span class="dv">15</span>    <span class="co"># number of years in the data set</span></a>
<a class="sourceLine" id="cb50-4" data-line-number="4">b0 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">ncol=</span>nocc<span class="dv">-1</span>, <span class="dt">nrow=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb50-5" data-line-number="5">b0[<span class="dv">1</span>,] &lt;-<span class="st"> </span><span class="kw">rbeta</span>((nocc<span class="dv">-1</span>), <span class="dv">3</span>, <span class="dv">4</span>) <span class="co"># capture probability of males</span></a>
<a class="sourceLine" id="cb50-6" data-line-number="6">b0[<span class="dv">2</span>,] &lt;-<span class="st"> </span><span class="kw">rbeta</span>((nocc<span class="dv">-1</span>), <span class="dv">2</span>, <span class="dv">4</span>) <span class="co"># capture probability of females  </span></a>
<a class="sourceLine" id="cb50-7" data-line-number="7">a0 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">ncol=</span><span class="dv">2</span>, <span class="dt">nrow=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb50-8" data-line-number="8">a1 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">ncol=</span><span class="dv">2</span>, <span class="dt">nrow=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb50-9" data-line-number="9">a0[<span class="dv">1</span>,<span class="dv">1</span>]&lt;-<span class="st"> </span><span class="kw">qlogis</span>(<span class="fl">0.7</span>) <span class="co"># average annual survival for adult males</span></a>
<a class="sourceLine" id="cb50-10" data-line-number="10">a0[<span class="dv">1</span>,<span class="dv">2</span>]&lt;-<span class="st"> </span><span class="kw">qlogis</span>(<span class="fl">0.3</span>) <span class="co"># average annual survival for juveniles</span></a>
<a class="sourceLine" id="cb50-11" data-line-number="11">a0[<span class="dv">2</span>,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">qlogis</span>(<span class="fl">0.55</span>) <span class="co"># average annual survival for adult females</span></a>
<a class="sourceLine" id="cb50-12" data-line-number="12">a0[<span class="dv">2</span>,<span class="dv">2</span>] &lt;-<span class="st"> </span>a0[<span class="dv">1</span>,<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb50-13" data-line-number="13">a1[<span class="dv">1</span>,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb50-14" data-line-number="14">a1[<span class="dv">1</span>,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="fl">-0.3</span></a>
<a class="sourceLine" id="cb50-15" data-line-number="15">a1[<span class="dv">2</span>,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="fl">-0.4</span></a>
<a class="sourceLine" id="cb50-16" data-line-number="16">a1[<span class="dv">2</span>,<span class="dv">2</span>] &lt;-<span class="st"> </span>a1[<span class="dv">1</span>,<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb50-17" data-line-number="17"></a>
<a class="sourceLine" id="cb50-18" data-line-number="18">nindi &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb50-19" data-line-number="19">nindni &lt;-<span class="st"> </span><span class="dv">1500</span></a>
<a class="sourceLine" id="cb50-20" data-line-number="20">nind &lt;-<span class="st"> </span>nindi <span class="op">+</span><span class="st"> </span>nindni</a>
<a class="sourceLine" id="cb50-21" data-line-number="21">y &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">ncol=</span>nocc, <span class="dt">nrow=</span>nind)</a>
<a class="sourceLine" id="cb50-22" data-line-number="22">first &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span>(nocc<span class="dv">-1</span>), nind, <span class="dt">replace=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb50-23" data-line-number="23">sex &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), nind, <span class="dt">prob=</span><span class="kw">c</span>(theta, <span class="dv">1</span><span class="op">-</span>theta), <span class="dt">replace=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb50-24" data-line-number="24">juv &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), nind, <span class="dt">prob=</span><span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>), <span class="dt">replace=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb50-25" data-line-number="25">x &lt;-<span class="st"> </span><span class="kw">runif</span>(nocc<span class="dv">-1</span>)                   <span class="co"># a covariate </span></a>
<a class="sourceLine" id="cb50-26" data-line-number="26"></a>
<a class="sourceLine" id="cb50-27" data-line-number="27"></a>
<a class="sourceLine" id="cb50-28" data-line-number="28">  int<span class="op">&lt;</span>lower=<span class="dv">0</span>,upper=<span class="dv">2</span><span class="op">&gt;</span><span class="st"> </span>yi[nindi,nocc];         <span class="op">/</span><span class="er">/</span><span class="st"> </span>CH[i,k]<span class="op">:</span><span class="st"> </span>individual i captured at k</a>
<a class="sourceLine" id="cb50-29" data-line-number="29">  int<span class="op">&lt;</span>lower=<span class="dv">0</span>,upper=nocc<span class="dv">-1</span><span class="op">&gt;</span><span class="st"> </span>firsti[nindi];      <span class="op">/</span><span class="er">/</span><span class="st"> </span>year of first capture</a>
<a class="sourceLine" id="cb50-30" data-line-number="30">  int<span class="op">&lt;</span>lower=<span class="dv">0</span>,upper=<span class="dv">2</span><span class="op">&gt;</span><span class="st"> </span>yni[nindni,nocc];       <span class="op">/</span><span class="er">/</span><span class="st"> </span>CH[i,k]<span class="op">:</span><span class="st"> </span>individual i captured at k</a>
<a class="sourceLine" id="cb50-31" data-line-number="31">  int<span class="op">&lt;</span>lower=<span class="dv">0</span>,upper=nocc<span class="dv">-1</span><span class="op">&gt;</span><span class="st"> </span>firstni[nindni];    <span class="op">/</span><span class="er">/</span><span class="st"> </span>year of first capture</a>
<a class="sourceLine" id="cb50-32" data-line-number="32">  int<span class="op">&lt;</span>lower=<span class="dv">1</span>, upper=<span class="dv">2</span><span class="op">&gt;</span><span class="st"> </span>sex[nindi];</a>
<a class="sourceLine" id="cb50-33" data-line-number="33">  int<span class="op">&lt;</span>lower=<span class="dv">1</span>, upper=<span class="dv">2</span><span class="op">&gt;</span><span class="st"> </span>juvi[nindi, nocc];</a>
<a class="sourceLine" id="cb50-34" data-line-number="34">  int<span class="op">&lt;</span>lower=<span class="dv">1</span>, upper=<span class="dv">2</span><span class="op">&gt;</span><span class="st"> </span>juvni[nindni, nocc];</a>
<a class="sourceLine" id="cb50-35" data-line-number="35">  int<span class="op">&lt;</span>lower=<span class="dv">1</span><span class="op">&gt;</span><span class="st"> </span>year[nocc];</a>
<a class="sourceLine" id="cb50-36" data-line-number="36"></a>
<a class="sourceLine" id="cb50-37" data-line-number="37"></a>
<a class="sourceLine" id="cb50-38" data-line-number="38"></a>
<a class="sourceLine" id="cb50-39" data-line-number="39">transformed parameters {</a>
<a class="sourceLine" id="cb50-40" data-line-number="40">  real<span class="op">&lt;</span>lower=<span class="dv">0</span>,upper=<span class="dv">1</span><span class="op">&gt;</span>p_male[nindni,nocc];         <span class="op">/</span><span class="er">/</span><span class="st"> </span>capture probability</a>
<a class="sourceLine" id="cb50-41" data-line-number="41">  real<span class="op">&lt;</span>lower=<span class="dv">0</span>,upper=<span class="dv">1</span><span class="op">&gt;</span>p_female[nindni,nocc];       <span class="op">/</span><span class="er">/</span><span class="st"> </span>capture probability</a>
<a class="sourceLine" id="cb50-42" data-line-number="42">  real<span class="op">&lt;</span>lower=<span class="dv">0</span>,upper=<span class="dv">1</span><span class="op">&gt;</span>p[nindi,nocc];               <span class="op">/</span><span class="er">/</span><span class="st"> </span>capture probability</a>
<a class="sourceLine" id="cb50-43" data-line-number="43"></a>
<a class="sourceLine" id="cb50-44" data-line-number="44">  real<span class="op">&lt;</span>lower=<span class="dv">0</span>,upper=<span class="dv">1</span><span class="op">&gt;</span>phi_male[nindni,nocc<span class="dv">-1</span>];   <span class="op">/</span><span class="er">/</span><span class="st"> </span>survival probability</a>
<a class="sourceLine" id="cb50-45" data-line-number="45">  real<span class="op">&lt;</span>lower=<span class="dv">0</span>,upper=<span class="dv">1</span><span class="op">&gt;</span>chi_male[nindni,nocc<span class="op">+</span><span class="dv">1</span>];   <span class="op">/</span><span class="er">/</span><span class="st"> </span>probability that an individual </a>
<a class="sourceLine" id="cb50-46" data-line-number="46">                                                  <span class="op">/</span><span class="er">/</span><span class="st"> </span>is never recaptured after its</a>
<a class="sourceLine" id="cb50-47" data-line-number="47">                                                  <span class="op">/</span><span class="er">/</span><span class="st"> </span>last capture</a>
<a class="sourceLine" id="cb50-48" data-line-number="48">  real<span class="op">&lt;</span>lower=<span class="dv">0</span>,upper=<span class="dv">1</span><span class="op">&gt;</span>phi_female[nindni,nocc<span class="dv">-1</span>]; <span class="op">/</span><span class="er">/</span><span class="st"> </span>survival probability</a>
<a class="sourceLine" id="cb50-49" data-line-number="49">  real<span class="op">&lt;</span>lower=<span class="dv">0</span>,upper=<span class="dv">1</span><span class="op">&gt;</span>chi_female[nindni,nocc<span class="op">+</span><span class="dv">1</span>]; <span class="op">/</span><span class="er">/</span><span class="st"> </span>probability that an individual </a>
<a class="sourceLine" id="cb50-50" data-line-number="50">                                                  <span class="op">/</span><span class="er">/</span><span class="st"> </span>is never recaptured after its</a>
<a class="sourceLine" id="cb50-51" data-line-number="51">                                                   <span class="op">/</span><span class="er">/</span><span class="st"> </span>last capture</a>
<a class="sourceLine" id="cb50-52" data-line-number="52">  real<span class="op">&lt;</span>lower=<span class="dv">0</span>,upper=<span class="dv">1</span><span class="op">&gt;</span>phi[nindi,nocc<span class="dv">-1</span>];   <span class="op">/</span><span class="er">/</span><span class="st"> </span>survival probability</a>
<a class="sourceLine" id="cb50-53" data-line-number="53">  real<span class="op">&lt;</span>lower=<span class="dv">0</span>,upper=<span class="dv">1</span><span class="op">&gt;</span>chi[nindi,nocc<span class="op">+</span><span class="dv">1</span>];   <span class="op">/</span><span class="er">/</span><span class="st"> </span>probability that an individual </a>
<a class="sourceLine" id="cb50-54" data-line-number="54">                                            <span class="op">/</span><span class="er">/</span><span class="st"> </span>is never recaptured after its</a>
<a class="sourceLine" id="cb50-55" data-line-number="55">                                            <span class="op">/</span><span class="er">/</span><span class="st"> </span>last capture</a>
<a class="sourceLine" id="cb50-56" data-line-number="56"></a>
<a class="sourceLine" id="cb50-57" data-line-number="57">  {</a>
<a class="sourceLine" id="cb50-58" data-line-number="58">    int k; </a>
<a class="sourceLine" id="cb50-59" data-line-number="59">    int kk; </a>
<a class="sourceLine" id="cb50-60" data-line-number="60">    <span class="cf">for</span>(ii <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nindi){</a>
<a class="sourceLine" id="cb50-61" data-line-number="61">      <span class="cf">if</span> (firsti[ii]<span class="op">&gt;</span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb50-62" data-line-number="62">        <span class="cf">for</span> (z <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(firsti[ii]<span class="op">-</span><span class="dv">1</span>)){</a>
<a class="sourceLine" id="cb50-63" data-line-number="63">          phi[ii,z] =<span class="st"> </span><span class="dv">1</span>;</a>
<a class="sourceLine" id="cb50-64" data-line-number="64">        }</a>
<a class="sourceLine" id="cb50-65" data-line-number="65">      }</a>
<a class="sourceLine" id="cb50-66" data-line-number="66">      <span class="cf">for</span>(tt <span class="cf">in</span> firsti[ii]<span class="op">:</span>(nocc<span class="dv">-1</span>)) {</a>
<a class="sourceLine" id="cb50-67" data-line-number="67">        <span class="op">/</span><span class="er">/</span><span class="st"> </span>linear predictor <span class="cf">for</span> phi<span class="op">:</span></a>
<a class="sourceLine" id="cb50-68" data-line-number="68"><span class="st">        </span>phi[ii,tt] =<span class="st"> </span><span class="kw">inv_logit</span>(a0[sex[ii], juvi[ii,tt]] <span class="op">+</span><span class="st"> </span>a1[sex[ii], juvi[ii,tt]]<span class="op">*</span>x[tt]); </a>
<a class="sourceLine" id="cb50-69" data-line-number="69"></a>
<a class="sourceLine" id="cb50-70" data-line-number="70">      }</a>
<a class="sourceLine" id="cb50-71" data-line-number="71">    }</a>
<a class="sourceLine" id="cb50-72" data-line-number="72"></a>
<a class="sourceLine" id="cb50-73" data-line-number="73">    <span class="cf">for</span>(ii <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nindni){</a>
<a class="sourceLine" id="cb50-74" data-line-number="74">      <span class="cf">if</span> (firstni[ii]<span class="op">&gt;</span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb50-75" data-line-number="75">        <span class="cf">for</span> (z <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(firstni[ii]<span class="op">-</span><span class="dv">1</span>)){</a>
<a class="sourceLine" id="cb50-76" data-line-number="76">          phi_female[ii,z] =<span class="st"> </span><span class="dv">1</span>;</a>
<a class="sourceLine" id="cb50-77" data-line-number="77">          phi_male[ii,z] =<span class="st"> </span><span class="dv">1</span>;</a>
<a class="sourceLine" id="cb50-78" data-line-number="78">        }</a>
<a class="sourceLine" id="cb50-79" data-line-number="79">      }</a>
<a class="sourceLine" id="cb50-80" data-line-number="80">      <span class="cf">for</span>(tt <span class="cf">in</span> firstni[ii]<span class="op">:</span>(nocc<span class="dv">-1</span>)) {</a>
<a class="sourceLine" id="cb50-81" data-line-number="81">        <span class="op">/</span><span class="er">/</span><span class="st"> </span>linear predictor <span class="cf">for</span> phi<span class="op">:</span></a>
<a class="sourceLine" id="cb50-82" data-line-number="82"><span class="st">        </span>phi_male[ii,tt] =<span class="st"> </span><span class="kw">inv_logit</span>(a0[<span class="dv">1</span>, juvni[ii,tt]] <span class="op">+</span><span class="st"> </span>a1[<span class="dv">1</span>, juvni[ii,tt]]<span class="op">*</span>x[tt]); </a>
<a class="sourceLine" id="cb50-83" data-line-number="83">        phi_female[ii,tt] =<span class="st"> </span><span class="kw">inv_logit</span>(a0[<span class="dv">2</span>, juvni[ii,tt]]<span class="op">+</span><span class="st"> </span>a1[<span class="dv">2</span>, juvni[ii,tt]]<span class="op">*</span>x[tt]);</a>
<a class="sourceLine" id="cb50-84" data-line-number="84"></a>
<a class="sourceLine" id="cb50-85" data-line-number="85">      }</a>
<a class="sourceLine" id="cb50-86" data-line-number="86">    }</a>
<a class="sourceLine" id="cb50-87" data-line-number="87">    </a>
<a class="sourceLine" id="cb50-88" data-line-number="88">    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nindi) {</a>
<a class="sourceLine" id="cb50-89" data-line-number="89">      <span class="op">/</span><span class="er">/</span><span class="st"> </span>linear predictor <span class="cf">for</span> p <span class="cf">for</span> identified individuals</a>
<a class="sourceLine" id="cb50-90" data-line-number="90">      <span class="cf">for</span>(w <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>firsti[i]){</a>
<a class="sourceLine" id="cb50-91" data-line-number="91">        p[i,w] =<span class="st"> </span><span class="dv">1</span>;</a>
<a class="sourceLine" id="cb50-92" data-line-number="92">      }</a>
<a class="sourceLine" id="cb50-93" data-line-number="93">      <span class="cf">for</span>(kkk <span class="cf">in</span> (firsti[i]<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>nocc)</a>
<a class="sourceLine" id="cb50-94" data-line-number="94">        p[i,kkk] =<span class="st"> </span>b0[sex[i],year[kkk<span class="dv">-1</span>]];  </a>
<a class="sourceLine" id="cb50-95" data-line-number="95">      chi[i,nocc<span class="op">+</span><span class="dv">1</span>] =<span class="st"> </span><span class="fl">1.0</span>;              </a>
<a class="sourceLine" id="cb50-96" data-line-number="96">      k =<span class="st"> </span>nocc;</a>
<a class="sourceLine" id="cb50-97" data-line-number="97">      <span class="cf">while</span> (k <span class="op">&gt;</span><span class="st"> </span>firsti[i]) {</a>
<a class="sourceLine" id="cb50-98" data-line-number="98">        chi[i,k] =<span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>phi[i,k<span class="dv">-1</span>]) <span class="op">+</span><span class="st"> </span>phi[i,k<span class="dv">-1</span>] <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p[i,k]) <span class="op">*</span><span class="st"> </span>chi[i,k<span class="op">+</span><span class="dv">1</span>]; </a>
<a class="sourceLine" id="cb50-99" data-line-number="99">        k =<span class="st"> </span>k <span class="op">-</span><span class="st"> </span><span class="dv">1</span>;</a>
<a class="sourceLine" id="cb50-100" data-line-number="100">      }</a>
<a class="sourceLine" id="cb50-101" data-line-number="101">      <span class="cf">if</span> (firsti[i]<span class="op">&gt;</span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb50-102" data-line-number="102">        <span class="cf">for</span> (u <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(firsti[i]<span class="op">-</span><span class="dv">1</span>)){</a>
<a class="sourceLine" id="cb50-103" data-line-number="103">          chi[i,u] =<span class="st"> </span><span class="dv">0</span>;</a>
<a class="sourceLine" id="cb50-104" data-line-number="104">        }</a>
<a class="sourceLine" id="cb50-105" data-line-number="105">      }</a>
<a class="sourceLine" id="cb50-106" data-line-number="106">      chi[i,firsti[i]] =<span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p[i,firsti[i]]) <span class="op">*</span><span class="st"> </span>chi[i,firsti[i]<span class="op">+</span><span class="dv">1</span>];</a>
<a class="sourceLine" id="cb50-107" data-line-number="107">    }<span class="op">/</span><span class="er">/</span><span class="st"> </span>close definition of transformed parameters <span class="cf">for</span> identified individuals</a>
<a class="sourceLine" id="cb50-108" data-line-number="108"></a>
<a class="sourceLine" id="cb50-109" data-line-number="109">    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nindni) {</a>
<a class="sourceLine" id="cb50-110" data-line-number="110">      <span class="op">/</span><span class="er">/</span><span class="st"> </span>linear predictor <span class="cf">for</span> p <span class="cf">for</span> non<span class="op">-</span>identified individuals</a>
<a class="sourceLine" id="cb50-111" data-line-number="111">      <span class="cf">for</span>(w <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>firstni[i]){</a>
<a class="sourceLine" id="cb50-112" data-line-number="112">        p_male[i,w] =<span class="st"> </span><span class="dv">1</span>;</a>
<a class="sourceLine" id="cb50-113" data-line-number="113">        p_female[i,w] =<span class="st"> </span><span class="dv">1</span>;</a>
<a class="sourceLine" id="cb50-114" data-line-number="114">      }</a>
<a class="sourceLine" id="cb50-115" data-line-number="115">      <span class="cf">for</span>(kkkk <span class="cf">in</span> (firstni[i]<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>nocc){</a>
<a class="sourceLine" id="cb50-116" data-line-number="116">        p_male[i,kkkk] =<span class="st"> </span>b0[<span class="dv">1</span>,year[kkkk<span class="dv">-1</span>]];  </a>
<a class="sourceLine" id="cb50-117" data-line-number="117">        p_female[i,kkkk] =<span class="st"> </span>b0[<span class="dv">2</span>,year[kkkk<span class="dv">-1</span>]];</a>
<a class="sourceLine" id="cb50-118" data-line-number="118">      }</a>
<a class="sourceLine" id="cb50-119" data-line-number="119">      chi_male[i,nocc<span class="op">+</span><span class="dv">1</span>] =<span class="st"> </span><span class="fl">1.0</span>; </a>
<a class="sourceLine" id="cb50-120" data-line-number="120">      chi_female[i,nocc<span class="op">+</span><span class="dv">1</span>] =<span class="st"> </span><span class="fl">1.0</span>; </a>
<a class="sourceLine" id="cb50-121" data-line-number="121">      k =<span class="st"> </span>nocc;</a>
<a class="sourceLine" id="cb50-122" data-line-number="122">      <span class="cf">while</span> (k <span class="op">&gt;</span><span class="st"> </span>firstni[i]) {</a>
<a class="sourceLine" id="cb50-123" data-line-number="123">        chi_male[i,k] =<span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>phi_male[i,k<span class="dv">-1</span>]) <span class="op">+</span><span class="st"> </span>phi_male[i,k<span class="dv">-1</span>] <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p_male[i,k]) <span class="op">*</span><span class="st"> </span>chi_male[i,k<span class="op">+</span><span class="dv">1</span>]; </a>
<a class="sourceLine" id="cb50-124" data-line-number="124">        chi_female[i,k] =<span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>phi_female[i,k<span class="dv">-1</span>]) <span class="op">+</span><span class="st"> </span>phi_female[i,k<span class="dv">-1</span>] <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p_female[i,k]) <span class="op">*</span><span class="st"> </span>chi_female[i,k<span class="op">+</span><span class="dv">1</span>]; </a>
<a class="sourceLine" id="cb50-125" data-line-number="125">        k =<span class="st"> </span>k <span class="op">-</span><span class="st"> </span><span class="dv">1</span>;</a>
<a class="sourceLine" id="cb50-126" data-line-number="126">      }</a>
<a class="sourceLine" id="cb50-127" data-line-number="127">      <span class="cf">if</span> (firstni[i]<span class="op">&gt;</span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb50-128" data-line-number="128">        <span class="cf">for</span> (u <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(firstni[i]<span class="op">-</span><span class="dv">1</span>)){</a>
<a class="sourceLine" id="cb50-129" data-line-number="129">          chi_male[i,u] =<span class="st"> </span><span class="dv">0</span>;</a>
<a class="sourceLine" id="cb50-130" data-line-number="130">          chi_female[i,u] =<span class="st"> </span><span class="dv">0</span>;</a>
<a class="sourceLine" id="cb50-131" data-line-number="131">        }</a>
<a class="sourceLine" id="cb50-132" data-line-number="132">      }</a>
<a class="sourceLine" id="cb50-133" data-line-number="133">      chi_male[i,firstni[i]] =<span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p_male[i,firstni[i]]) <span class="op">*</span><span class="st"> </span>chi_male[i,firstni[i]<span class="op">+</span><span class="dv">1</span>];</a>
<a class="sourceLine" id="cb50-134" data-line-number="134">      chi_female[i,firstni[i]] =<span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p_female[i,firstni[i]]) <span class="op">*</span><span class="st"> </span>chi_female[i,firstni[i]<span class="op">+</span><span class="dv">1</span>];</a>
<a class="sourceLine" id="cb50-135" data-line-number="135">    } <span class="op">/</span><span class="er">/</span><span class="st"> </span>close definition of transformed parameters <span class="cf">for</span> non<span class="op">-</span>identified individuals</a>
<a class="sourceLine" id="cb50-136" data-line-number="136"></a>
<a class="sourceLine" id="cb50-137" data-line-number="137">    </a>
<a class="sourceLine" id="cb50-138" data-line-number="138">  }  <span class="op">/</span><span class="er">/</span><span class="st"> </span>close block of transformed parameters exclusive parameter declarations</a>
<a class="sourceLine" id="cb50-139" data-line-number="139">}    <span class="op">/</span><span class="er">/</span><span class="st"> </span>close transformed parameters</a>
<a class="sourceLine" id="cb50-140" data-line-number="140"></a>
<a class="sourceLine" id="cb50-141" data-line-number="141">model {</a>
<a class="sourceLine" id="cb50-142" data-line-number="142"></a>
<a class="sourceLine" id="cb50-143" data-line-number="143">  <span class="op">/</span><span class="er">/</span><span class="st"> </span>likelihood <span class="cf">for</span> identified individuals</a>
<a class="sourceLine" id="cb50-144" data-line-number="144">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nindi) {</a>
<a class="sourceLine" id="cb50-145" data-line-number="145">    <span class="cf">if</span> (lasti[i]<span class="op">&gt;</span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb50-146" data-line-number="146">      <span class="cf">for</span> (k <span class="cf">in</span> firsti[i]<span class="op">:</span>lasti[i]) {</a>
<a class="sourceLine" id="cb50-147" data-line-number="147">        <span class="cf">if</span>(k<span class="op">&gt;</span><span class="dv">1</span>) target<span class="op">+</span><span class="er">=</span><span class="st"> </span>(<span class="kw">log</span>(phi[i, k<span class="dv">-1</span>])); </a>
<a class="sourceLine" id="cb50-148" data-line-number="148">        <span class="cf">if</span> (yi[i,k] <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) target<span class="op">+</span><span class="er">=</span>(<span class="kw">log</span>(p[i,k]));   </a>
<a class="sourceLine" id="cb50-149" data-line-number="149">        <span class="cf">else</span> target<span class="op">+</span><span class="er">=</span>(<span class="kw">log1m</span>(p[i,k]));  </a>
<a class="sourceLine" id="cb50-150" data-line-number="150">      }</a>
<a class="sourceLine" id="cb50-151" data-line-number="151">    }  </a>
<a class="sourceLine" id="cb50-152" data-line-number="152">    target<span class="op">+</span><span class="er">=</span>(<span class="kw">log</span>(chi[i,lasti[i]<span class="op">+</span><span class="dv">1</span>]));</a>
<a class="sourceLine" id="cb50-153" data-line-number="153">  }</a></code></pre></div>
</div>
<div id="model-description" class="section level2">
<h2><span class="header-section-number">17.3</span> Model description</h2>
<p>For the annual data, time period t was one year (of 15 years in total), and for the monthly data, time period t was one month (of 169 months in total).<br />
The observations yit, an indicator of whether individual i was recaptured during time period t is modelled conditional on the latent true state of the individual birds zit (0 = dead or permanently emigrated, 1 = alive and at the study site) as a Bernoulli variable. The probability P(yit = 1) is the product of the probability that an alive individual is recaptured, pit, and the state of the bird zit (alive = 1, dead = 0). Thus, a dead bird cannot be recaptured, whereas for a bird alive during time period t, the recapture probability equals pit:
yit ~ Bernoulli(zitpit)
The latent state variable zit is a Markovian variable with the state at time t being dependent on the state at time t-1 and the apparent survival probability it:
zit ~ Bernoulli(zit-1it)
We use the term apparent survival in order to indicate that the parameter  is a product of site fidelity and survival. Thus, individuals that permanently emigrated from the study area cannot be distinguished from dead individuals.
In both models, the parameters and p were modelled as sex-specific. However, for 61% of the individuals, sex could not be identified, i.e. sex was missing. Ignoring these missing values would most likely lead to a bias because they were not missing at random. The probability that sex can be identified is increasing with age and most likely differs between sexes. Therefore, we included a mixture model for the sex:
Sexi ~ Categorical(q)
where q is a vector of length 2, containing the probability of being a male and a female, respectively. In this way, the sex of the non-identified individuals was assumed to be male or female with probability q[1] and q[2]=1-q[1], respectively. This model corresponds to the finite mixture model introduced by Pledger et al. (2003) in order to account for unknown classes of birds (heterogeneity). However, in our case, for parts of the individuals the class (sex) was known.</p>
<p>Annual survival models
We used two different models for annual apparent survival. In the first model, we estimated independent annual survival for each year, age and sex class (3 levels: juveniles, adult males and adult females):
Model 1:it = a t,age.sex[it]
Annual recapture probability was modelled for each year and age and sex class independently:
pit = b0t,age.sex[it]
Uniform prior distributions were used for all parameters with a parameter space limited to values between 0 and 1 (probabilities) and a normal distribution with a mean of 0 and a standard deviation of 1.5 for the intercept a0. A standard deviation of 5 was used for a1, a2, a3, and a4.</p>
</div>
<div id="the-stan-code" class="section level2">
<h2><span class="header-section-number">17.4</span> The Stan code</h2>
<p>The trick for coding the CMR-mixture model in Stan is to formulate the model 3 times:
1. For the individuals with identified sex
2. For the males that were not identified
3. For the females that were not identified</p>
<p>Then for the non-identified individuals a mixture model is formulated that assigns a probability of being a female or a male to each individual.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="zeroinflated-poisson-lmm.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="referenzen.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/TobiasRoth/BDAEcology/edit/master/45-cjs_with_mix.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
