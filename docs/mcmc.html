<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Data Analysis in Ecology with R and Stan</title>
  <meta name="description" content="This GitHub-book is collection of updates and additional material to the book Bayesian Data Analysis in Ecology Using Linear Models with R, BUGS, and STAN.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Data Analysis in Ecology with R and Stan" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/cover.jpg" />
  <meta property="og:description" content="This GitHub-book is collection of updates and additional material to the book Bayesian Data Analysis in Ecology Using Linear Models with R, BUGS, and STAN." />
  <meta name="github-repo" content="TobiasRoth/BDAEcology" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Data Analysis in Ecology with R and Stan" />
  
  <meta name="twitter:description" content="This GitHub-book is collection of updates and additional material to the book Bayesian Data Analysis in Ecology Using Linear Models with R, BUGS, and STAN." />
  <meta name="twitter:image" content="images/cover.jpg" />

<meta name="author" content="FrÃ¤nzi Korner-Nievergelt and Tobias Roth">


<meta name="date" content="2018-08-13">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="priors.html">
<link rel="next" href="ridge.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="Settings/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-this-book"><i class="fa fa-check"></i>Why this book?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-this-book"><i class="fa fa-check"></i>About this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-contribute"><i class="fa fa-check"></i>How to contribute?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="part"><span><b>I R FOR ECOLOGISTS</b></span></li>
<li class="chapter" data-level="1" data-path="PART-I.html"><a href="PART-I.html"><i class="fa fa-check"></i><b>1</b> Introduction to PART I</a><ul>
<li class="chapter" data-level="1.1" data-path="PART-I.html"><a href="PART-I.html#further-reading"><i class="fa fa-check"></i><b>1.1</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="analyses-steps.html"><a href="analyses-steps.html"><i class="fa fa-check"></i><b>2</b> Data analysis step by step</a><ul>
<li class="chapter" data-level="2.1" data-path="analyses-steps.html"><a href="analyses-steps.html#step1"><i class="fa fa-check"></i><b>2.1</b> Plausibility of Data</a></li>
<li class="chapter" data-level="2.2" data-path="analyses-steps.html"><a href="analyses-steps.html#step2"><i class="fa fa-check"></i><b>2.2</b> Relationships</a></li>
<li class="chapter" data-level="2.3" data-path="analyses-steps.html"><a href="analyses-steps.html#step3"><i class="fa fa-check"></i><b>2.3</b> Error Distribution</a></li>
<li class="chapter" data-level="2.4" data-path="analyses-steps.html"><a href="analyses-steps.html#step4"><i class="fa fa-check"></i><b>2.4</b> Preparation of Explanatory Variables</a></li>
<li class="chapter" data-level="2.5" data-path="analyses-steps.html"><a href="analyses-steps.html#step5"><i class="fa fa-check"></i><b>2.5</b> Data Structure</a></li>
<li class="chapter" data-level="2.6" data-path="analyses-steps.html"><a href="analyses-steps.html#step6"><i class="fa fa-check"></i><b>2.6</b> Fit the Model</a></li>
<li class="chapter" data-level="2.7" data-path="analyses-steps.html"><a href="analyses-steps.html#step7"><i class="fa fa-check"></i><b>2.7</b> Check Model</a></li>
<li class="chapter" data-level="2.8" data-path="analyses-steps.html"><a href="analyses-steps.html#step8"><i class="fa fa-check"></i><b>2.8</b> Model Uncertainty</a></li>
<li class="chapter" data-level="2.9" data-path="analyses-steps.html"><a href="analyses-steps.html#step9"><i class="fa fa-check"></i><b>2.9</b> Draw Conclusions</a></li>
<li class="chapter" data-level="" data-path="analyses-steps.html"><a href="analyses-steps.html#further-reading-1"><i class="fa fa-check"></i>Further reading</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="datamanip.html"><a href="datamanip.html"><i class="fa fa-check"></i><b>3</b> Data preparation</a><ul>
<li class="chapter" data-level="3.1" data-path="datamanip.html"><a href="datamanip.html#basic-operations"><i class="fa fa-check"></i><b>3.1</b> Basic operations</a></li>
<li class="chapter" data-level="3.2" data-path="datamanip.html"><a href="datamanip.html#conection-to-existing-sql-db"><i class="fa fa-check"></i><b>3.2</b> Conection to existing sql-DB</a><ul>
<li class="chapter" data-level="3.2.1" data-path="datamanip.html"><a href="datamanip.html#abfragen-zur-artenvielfalt"><i class="fa fa-check"></i><b>3.2.1</b> Abfragen zur Artenvielfalt</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="datamanip.html"><a href="datamanip.html#further-reading-2"><i class="fa fa-check"></i><b>3.3</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="figures.html"><a href="figures.html"><i class="fa fa-check"></i><b>4</b> Visualizations</a><ul>
<li class="chapter" data-level="4.1" data-path="figures.html"><a href="figures.html#short-checklist-for-figures"><i class="fa fa-check"></i><b>4.1</b> Short Checklist for figures</a></li>
<li class="chapter" data-level="" data-path="figures.html"><a href="figures.html#further-reading-3"><i class="fa fa-check"></i>Further reading</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="distributions.html"><a href="distributions.html"><i class="fa fa-check"></i><b>5</b> Probability distributions</a><ul>
<li class="chapter" data-level="5.1" data-path="distributions.html"><a href="distributions.html#introduction"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="distributions.html"><a href="distributions.html#normal-distribution"><i class="fa fa-check"></i><b>5.2</b> Normal distribution</a></li>
<li class="chapter" data-level="5.3" data-path="distributions.html"><a href="distributions.html#poisson-distribution"><i class="fa fa-check"></i><b>5.3</b> Poisson distribution</a></li>
<li class="chapter" data-level="5.4" data-path="distributions.html"><a href="distributions.html#gamma-distribution"><i class="fa fa-check"></i><b>5.4</b> Gamma distribution</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="rgis.html"><a href="rgis.html"><i class="fa fa-check"></i><b>6</b> Spatial analyses and maps</a><ul>
<li class="chapter" data-level="6.1" data-path="rgis.html"><a href="rgis.html#hintergrund"><i class="fa fa-check"></i><b>6.1</b> Hintergrund</a></li>
<li class="chapter" data-level="6.2" data-path="rgis.html"><a href="rgis.html#coordinate-systems"><i class="fa fa-check"></i><b>6.2</b> Coordinate systems</a></li>
<li class="chapter" data-level="6.3" data-path="rgis.html"><a href="rgis.html#further-reading-4"><i class="fa fa-check"></i><b>6.3</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="reproducible.html"><a href="reproducible.html"><i class="fa fa-check"></i><b>7</b> Reproducible Research</a><ul>
<li class="chapter" data-level="7.1" data-path="reproducible.html"><a href="reproducible.html#introduction-1"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="reproducible.html"><a href="reproducible.html#add-citations"><i class="fa fa-check"></i><b>7.2</b> Add citations</a></li>
<li class="chapter" data-level="7.3" data-path="reproducible.html"><a href="reproducible.html#further-reading-5"><i class="fa fa-check"></i><b>7.3</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="furthertopics.html"><a href="furthertopics.html"><i class="fa fa-check"></i><b>8</b> Further topics</a><ul>
<li class="chapter" data-level="8.1" data-path="furthertopics.html"><a href="furthertopics.html#bioacoustic-analyse"><i class="fa fa-check"></i><b>8.1</b> Bioacoustic analyse</a></li>
<li class="chapter" data-level="8.2" data-path="furthertopics.html"><a href="furthertopics.html#python"><i class="fa fa-check"></i><b>8.2</b> Python</a></li>
</ul></li>
<li class="part"><span><b>II BAYESIAN DATA ANALYSIS</b></span></li>
<li class="chapter" data-level="9" data-path="PART-II.html"><a href="PART-II.html"><i class="fa fa-check"></i><b>9</b> Introduction to PART II</a><ul>
<li class="chapter" data-level="" data-path="PART-II.html"><a href="PART-II.html#further-reading-6"><i class="fa fa-check"></i>Further reading</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="priors.html"><a href="priors.html"><i class="fa fa-check"></i><b>10</b> Prior distributions</a><ul>
<li class="chapter" data-level="10.1" data-path="priors.html"><a href="priors.html#introduction-2"><i class="fa fa-check"></i><b>10.1</b> Introduction</a></li>
<li class="chapter" data-level="10.2" data-path="priors.html"><a href="priors.html#choosepriors"><i class="fa fa-check"></i><b>10.2</b> How to choose a prior</a></li>
<li class="chapter" data-level="10.3" data-path="priors.html"><a href="priors.html#prior-sensitivity"><i class="fa fa-check"></i><b>10.3</b> Prior sensitivity</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="mcmc.html"><a href="mcmc.html"><i class="fa fa-check"></i><b>11</b> Markov Chain Monte Carlo Simulation</a><ul>
<li class="chapter" data-level="11.1" data-path="mcmc.html"><a href="mcmc.html#background"><i class="fa fa-check"></i><b>11.1</b> Background</a></li>
<li class="chapter" data-level="11.2" data-path="mcmc.html"><a href="mcmc.html#mcmc-using-stan"><i class="fa fa-check"></i><b>11.2</b> MCMC using Stan</a></li>
<li class="chapter" data-level="" data-path="mcmc.html"><a href="mcmc.html#further-reading-7"><i class="fa fa-check"></i>Further reading</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="ridge.html"><a href="ridge.html"><i class="fa fa-check"></i><b>12</b> Ridge regression</a><ul>
<li class="chapter" data-level="12.1" data-path="ridge.html"><a href="ridge.html#introduction-3"><i class="fa fa-check"></i><b>12.1</b> Introduction</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="sem.html"><a href="sem.html"><i class="fa fa-check"></i><b>13</b> Structural equation model</a><ul>
<li class="chapter" data-level="13.1" data-path="sem.html"><a href="sem.html#introduction-4"><i class="fa fa-check"></i><b>13.1</b> Introduction</a></li>
</ul></li>
<li class="part"><span><b>III ECOLOGICAL MODELS</b></span></li>
<li class="chapter" data-level="14" data-path="PART-III.html"><a href="PART-III.html"><i class="fa fa-check"></i><b>14</b> Introduction to PART III</a><ul>
<li class="chapter" data-level="14.1" data-path="PART-III.html"><a href="PART-III.html#model-notations"><i class="fa fa-check"></i><b>14.1</b> Model notations</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="zeroinflated-poisson-lmm.html"><a href="zeroinflated-poisson-lmm.html"><i class="fa fa-check"></i><b>15</b> Zero-inflated Poisson Mixed Model</a><ul>
<li class="chapter" data-level="15.1" data-path="zeroinflated-poisson-lmm.html"><a href="zeroinflated-poisson-lmm.html#introduction-5"><i class="fa fa-check"></i><b>15.1</b> Introduction</a></li>
<li class="chapter" data-level="15.2" data-path="zeroinflated-poisson-lmm.html"><a href="zeroinflated-poisson-lmm.html#example-data"><i class="fa fa-check"></i><b>15.2</b> Example data</a></li>
<li class="chapter" data-level="15.3" data-path="zeroinflated-poisson-lmm.html"><a href="zeroinflated-poisson-lmm.html#model"><i class="fa fa-check"></i><b>15.3</b> Model</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="cjs-with-mix.html"><a href="cjs-with-mix.html"><i class="fa fa-check"></i><b>16</b> FrÃ¤nzi Modell</a><ul>
<li class="chapter" data-level="16.1" data-path="cjs-with-mix.html"><a href="cjs-with-mix.html#introduction-6"><i class="fa fa-check"></i><b>16.1</b> Introduction</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="referenzen.html"><a href="referenzen.html"><i class="fa fa-check"></i>Referenzen</a></li>
<li class="divider"></li>
</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Analysis in Ecology with R and Stan</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mcmc" class="section level1">
<h1><span class="header-section-number">11</span> Markov Chain Monte Carlo Simulation</h1>
<div id="background" class="section level2">
<h2><span class="header-section-number">11.1</span> Background</h2>
<p>Markov chain Monte Carlo (MCMC) simulation techniques were developed in the mid-1950s by physicists (Metropolis et al., 1953). Later, statisticians discovered MCMC (Hastings, 1970; Geman &amp; Geman, 1984; Tanner &amp; Wong, 1987; Gelfand et al., 1990; Gelfand &amp; Smith, 1990). MCMC methods make it possible to obtain posterior distributions for parameters and latent variables (unobserved variables) of complex models. In parallel, personal computer capacities increased in the 1990s and user-friendly software such as the different programs based on the programming language BUGS (Spiegelhalter et al., 2003) came out. These developments boosted the use of Bayesian data analyses, particularly in genetics and ecology.</p>
</div>
<div id="mcmc-using-stan" class="section level2">
<h2><span class="header-section-number">11.2</span> MCMC using Stan</h2>
<p>In this book we use the program <a href="http://mc-stan.org">Stan</a> to draw random samples from the joint posterior distribution of the model parameters given a model, the data, prior distributions, and initial values. To do so, it uses the âno-U-turn sampler,â which is a type of Hamiltonian Monte Carlo simulation (Hoffman &amp; Gelman, 2012; Betancourt, 2013), and optimization-based point estimation. These algorithms are more efficient than the ones implemented in BUGS programs and they can handle larger data sets. Stan works particularly well for hierar- chical models (Betancourt &amp; Girolami, 2013). For example, the mark- recapture model with random effects presented in Section 14.5 used less than 2 hours in Stan to obtain a similar effective sample size as WinBUGS produced after several days. This motivated us to learn Stan in addition to BUGS and to cover Stan in this book.</p>
<p>Stan runs on Windows, Mac, and Linux. It is freely available from <a href="http://mc-stan.org/" class="uri">http://mc-stan.org/</a>. Stan can be used via the R interface rstan. Stan is automatically installed when the R package rstan is installed. For installing rstan, it is advised to follow closely the system-specific instructions. Stan requires that a CÃ¾Ã¾ compiler is installed on the computer. Therefore, before downloading rstan we have to install a CÃ¾Ã¾ compiler (e.g., Rtools). How to do this is explained very well on the Stan website. Besides the interface to R, interfaces to Python, PyStan, and to the shell, CmdStan, are available.</p>
<p>The use of Stan is similar to BUGS. The model has to be defined in a text file, the data prepared within R, and then Stan is called from R. However, the Stan language differs from BUGS and it is stricter, forcing the user to write unambiguous models. A comprehensive manual introduces the Stan language (Stan Development Team, 2014), downloadable from mc-stan.org.</p>
<p>A Stan code defining a model consists of different named blocks. These blocks are (from first to last): data, transformed data, parameters, trans- formed parameters, model, and generated quantities. The blocks must appear in this order. The model block is mandatory; all other blocks are optional. In the data block, the type, dimension, and name of every variable has to be declared. Optionally, the range of possible values can be specified. For example, vector[N] y; means that y is a vector (type real) of length N, and int<lower1â40> N; means that N is an integer with nonnegative values (the bounds, here 0, are included). Note that the restriction to a possible range of values is not strictly necessary but this will help specifying the correct model and it will improve speed. We also see that each line needs to be closed by a column sign. In the parameters block, all model parameters have to be defined. The coefficients of the linear predictor constitute a vector of length 2, vector[2] beta;. Alternatively, real beta[2]; could be used. The sigma parameter is a one-number parameter that has to be positive, therefore real<lower1â40> sigma;.</p>
<p>The model block contains the model specification. Unlike BUGS, Stan functions can handle vectors. Therefore, we do not have to loop through all observations. Here, we use a Cauchy distribution as a prior distribution for sigma. This distribution can have negative values, but because we defined the lower limit of sigma to be 0 in the parameters block, the prior distri- bution actually used in the model is a truncated Cauchy distribution (truncated at zero). In Chapter 15 we explain how to choose prior distributions.</p>
<p>Further characteristics of the Stan language that are good to know include: The variance parameter for the normal distribution is specified as the standard deviation (like in R but different from BUGS, where the precision is used). If no prior is specified, Stan uses a uniform prior over the range of possible values as specified in the parameter block. Variable names must not contain periods, for example, âx.zâ would not be allowed, but âx_zâ is allowed. To comment out a line, use double forward-slashes // (â#â in BUGS and R). The Stan website provides a large collection of model code that can be downloaded and adapted.</p>
<p>We fit the model to the data that has been produced in Chapter 4. There, the vectors x and y have been simulated and n is the sample size. Stan needs a vector containing the names of the data objects. In our case, x, y, and N are objects that exist in the R console.</p>
<p>The function stan starts Stan and returns an object containing MCMCs for every model parameter. We have to specify the name of the file that contains the model specification, the data, the number of chains, and the number of iterations per chain we would like to have. The first half of the iterations of each chain is declared as the warm-up. During the warm-up, Stan is not simulating a Markov chain, because in every step the algorithm is adapted. After the warm-up the algorithm is fixed and Stan simulates Markov chains.</p>
</div>
<div id="further-reading-7" class="section level2 unnumbered">
<h2>Further reading</h2>
<ul>
<li><a href="http://mc-stan.org">Stan-Homepage</a>: It contains the documentation for Stand a a lot of tutorials.</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="priors.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ridge.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/TobiasRoth/BDAEcology/edit/master/23-mcmc.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
